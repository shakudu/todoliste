<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Todo-liste</title>
    <link th:href="@{/webjars/bootstrap/4.0.0-beta/css/bootstrap.min.css}" rel="stylesheet" />
    <link type="text/css" rel="stylesheet" th:href="@{/webjars/bootstrap-glyphicons/bdd2cbfba0/css/bootstrap-glyphicons.css}" />
    <link type="text/css" rel="stylesheet" th:href="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.css}" />
    <link rel="stylesheet" href="/css/style.css"/>
</head>
<body>

<nav class="navbar navbar-dark bg-dark">
    <a class="navbar-brand" href="#">Todo-liste</a>
</nav>

<div class="modal" id="modal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal-title">Oppgave</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="id_group" class="form-group">
                    <label for="id">id:</label>
                    <input disabled="true" class="form-control form-control-sm" type="text" id="id" />
                </div>
                <div class="form-group">
                    <label class="form-control-label" for="textarea">Oppgave:</label>
                    <textarea id="textarea" class="form-control"></textarea>
                </div>
                <div class="form-group">
                    <label for="tidstopp">Start:</label>
                    <input class="form-control" type="text" id="tidstart" />
                </div>
                <div class="form-group">
                    <label for="tidstopp">Frist:</label>
                    <input class="form-control" type="text" id="tidstopp" />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="lagreKnapp" class="btn btn-success">Lagre</button>
                <button type="button" id="avbrytKnapp" class="btn btn-secondary" data-dismiss="modal">Avbryt</button>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div id="alerts"></div>
    <p>
        <span class="form-inline">
            <input autocomplete="off" id="search" class="form-control mr-sm-2" type="text" placeholder="Søk" aria-label="Search"/>
            <button id="nullstillKnapp" class="btn btn-default">Nullstill søk</button>
        </span>
    </p>

    <table class="table table-striped" id="tabell">
        <tr>
            <th>Oppgave</th>
            <th>Status</th>
            <th>Start</th>
            <th>Frist</th>
            <th>Handling</th>
        </tr>
        <tbody id="personlist">
            <tr>
                <td id="oppgave"></td>
                <td id="status"></td>
                <td id="start"></td>
                <td id="stopp"></td>
                <td id="handling"></td>
            </tr>
        </tbody>

    </table>
    <p class="text-muted" id="treff"></p>
    <button class="btn btn-primary" data-toggle="modal" data-target="#modal" id="nyknapp">Ny oppgave</button>
</div>

<footer class="footer">
    <div class="container">
        <p class="text-muted">IFT302 Webprogrammering - Oblig 2. Gard Marius Guldhav</p>
    </div>
</footer>

<script src="/webjars/jquery/3.2.1/jquery.min.js"></script>
<script src="/js/popper/1.11.0/popper.min.js"></script>
<script src="/webjars/bootstrap/4.0.0-beta/js/bootstrap.min.js"></script>
<script src="/webjars/jquery-ui/1.12.1/jquery-ui.min.js"></script>

<script src="/js/alert.js"></script>
<script src="/js/tableSearch.js"></script>
<script src="/js/skjemaKnapper.js"></script>
<script src="/js/tabellFunksjoner.js"></script>

<script>
    $(document).ready( function() {
        var format = 'dd/mm/yy';
        $( "#tidstopp" ).datepicker({
            dateFormat : format });
        $( "#tidstart" ).datepicker({
            dateFormat : format});

        tabellLoad();
        resetSearch(); // Kaller denne for å skjule "Nullstill søk"-knappen.
    });

    $("#tabell tbody").sortable({
        axis: "y",
        cursor: "move",
        stop: function() {
            updatePositions()
        }
    }).disableSelection();

    function updatePositions() {
        var order = 1;
        var data = [];
        $("#personlist").children().each(function () {
            var id = $(this).find(".redigerknapp").val();
            var task = $(this).find("#oppgave").text();
            var start = $(this).find("#start").text();
            var stopp = $(this).find("#stopp").text();
            if($(this).find("#status").text() == "Todo") { var comp = false; }
            else { var comp = true; }
            data.push({ "order" : order ,"id" : id, "task" : task, "tidStart" : start, "tidStopp" : stopp, "completed" : comp});
            order++;
        });

        $.ajax({
            url: '/api/todo/order',
            type: 'POST',
            contentType: "application/json;charset=UTF-8",
            dataType: "json",
            data: JSON.stringify(data),
            complete: function () {
                displayAlert("success", "OK","Rekkefølge lagret");
            }
        });
    }
</script>

</body>
</html>